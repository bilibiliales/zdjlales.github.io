<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>极速script捏谱</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <textarea id="output" rows="10" cols="50" style="background-color: gray;"></textarea>
    <div id="PianoPanel">
        <div class="piano-wrap">
            <div>
                <div class="piano-key">A1</div>
            </div>
            <div>
                <div class="piano-key">A2</div>
            </div>
            <div>
                <div class="piano-key">A3</div>
            </div>
            <div>
                <div class="piano-key">A4</div>
            </div>
            <div>
                <div class="piano-key">A5</div>
            </div>
            <div>
                <div class="piano-key">A6</div>
            </div>
            <div>
                <div class="piano-key">A7</div>
            </div>


            <div>
                <div class="piano-key">B1</div>
            </div>
            <div>
                <div class="piano-key">B2</div>
            </div>
            <div>
                <div class="piano-key">B3</div>
            </div>
            <div>
                <div class="piano-key">B4</div>
            </div>
            <div>
                <div class="piano-key">B5</div>
            </div>
            <div>
                <div class="piano-key">B6</div>
            </div>
            <div>
                <div class="piano-key">B7</div>
            </div>
            
            <div>
                <div class="piano-key">C1</div>
            </div>
        </div>
    </div>

    <script>
// 模拟移动设备状态的检测
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

// 获取所有的钢琴按键元素
const pianoKeys = document.querySelectorAll(".piano-wrap > div");

// 为每个按键添加事件监听器
pianoKeys.forEach(key => {
    let keyDown = () => {
        key.classList.add("piano-key-down");
    };
    let keyUp = () => {
        key.classList.remove("piano-key-down");
    };

    if (isMobile) {
        key.addEventListener("touchstart", keyDown);
        key.addEventListener("touchend", keyUp);
    } else {
        key.addEventListener("mousedown", keyDown);
        key.addEventListener("mouseup", keyUp);
    }
});

//读取key
function handleKeyClick(event) {
    const keyContent = getCorrespondingContent(event.target.textContent); 
    outputTextarea.value += keyContent; 
}

pianoKeys.forEach(key => {
    key.addEventListener('click', handleKeyClick);
});

//返回对应JS开源代码
function getCorrespondingContent(keyContent) {
    switch (keyContent) {
        case 'A1':
            return 'zdjl.click(A1.x,A1.y,0);sleep(a);\n';
        case 'A2':
            return 'zdjl.click(A2.x,A2.y,0);sleep(a);\n';
        case 'A3':
            return 'zdjl.click(A3.x,A3.y,0);sleep(a);\n';
        case 'A4':
            return 'zdjl.click(A4.x,A4.y,0);sleep(a);\n';
        case 'A5':
            return 'zdjl.click(A5.x,A5.y,0);sleep(a);\n';
        case 'A6':
            return 'zdjl.click(A6.x,A6.y,0);sleep(a);\n';
        case 'A7':
            return 'zdjl.click(A7.x,A7.y,0);sleep(a);\n';
        case 'B1':
            return 'zdjl.click(B1.x,B1.y,0);sleep(a);\n';
        case 'B2':
            return 'zdjl.click(B2.x,B2.y,0);sleep(a);\n';
        case 'B3':
            return 'zdjl.click(B3.x,B3.y,0);sleep(a);\n';
        case 'B4':
            return 'zdjl.click(B4.x,B4.y,0);sleep(a);\n';
        case 'B5':
            return 'zdjl.click(B5.x,B5.y,0);sleep(a);\n';
        case 'B6':
            return 'zdjl.click(B6.x,B6.y,0);sleep(a);\n';
        case 'B7':
            return 'zdjl.click(B7.x,B7.y,0);sleep(a);\n';
        case 'C1':
            return 'zdjl.click(C1.x,C1.y,0);sleep(a);\n';
        default:
            return ''; 
    }
}

//导出链接
const outputTextarea = document.getElementById('output');
const exportLink = document.createElement('a'); 
exportLink.textContent = '导出脚本代码'; 
exportLink.style.display = 'block'; 
exportLink.style.color = 'blue'; 
exportLink.style.fontSize = '20px'; 

//导出txt文件
function exportTxt() {
    const text = outputTextarea.value;
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    exportLink.href = url;
    exportLink.download = 'JS脚本代码.txt';
}

//导出脚本文件
document.getElementById('downloadButton').style.display = 'block';
const scriptDownloadButton = document.createElement('button');
scriptDownloadButton.innerText = '下载脚本文件';
document.getElementById('finished').appendChild(scriptDownloadButton);
//格式化zsj文件内容
const formatteScriptcode=`{"repeatCount":-1,"pauseOnFail":true,"count":3,"minVerCode":2026000,"minVerName":"2.26.0","screenWidth":0,"screenHeight":0,"screenDpi":0,"lastSaveScreenWidth":1312,"lastSaveScreenHeight":2848,"lastSaveScreenDpi":3.5,"savedVerCode":2027020,"savedVerName":"2.27.2","description":"`+"该脚本通过机器制造，基于开源3.3内核，仅可用作学习交流，不得进行商业化用途。3.3版本转换器可能存在原始BPM错误的情况，建议在var a;一行中增加：/数字的操作" + `","delay":""}
{"type":"设置变量","delay":"0","delayUnit":0,"desc":"录入位点用于后面的自动点屏幕用","scriptCallbacks":{"afterExecSuc":{"type":"系统提示","delay":"0","delayUnit":0,"condition":{"type":"jsExpression","runWhenFalse":true,"expression":"true","desc":""},"promptType":"alert","promptText":"一切准备就绪！点击确定即可开始运行","promptTitle":"进入游戏主界面后点击确定","showPosition":"default","playAudio":"false","useVibrator":false,"actions":[{"name":"确定"},{"name":"暂停显示5秒","script":{"type":"控制执行","delay":"5","delayUnit":1,"controlRunType":"jumpTo","jumpToPosition":"2","ContinueParentExecute":false}}],"showDuration":5000},"afterExecFail":{"type":"控制执行","delay":"0","delayUnit":1,"controlRunType":"stop","jumpToPosition":"","ContinueParentExecute":false}},"vars":[{"name":"设置音调","value":{"varType":"ui_text","varScope":"script","showInput":true,"mustInput":true,"showInputContentAlign":"left","textContent":"请按照从音调低到高的顺序设置好A1-C1","textSize":15,"textColor":"#e5e5e5"}},{"name":"A1","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A2","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A3","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A4","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A5","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A6","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"A7","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B1","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B2","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B3","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B4","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B5","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B6","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"B7","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"C1","value":{"varType":"position","varScope":"script","showInput":true,"mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","position":{"type":"location","x":"50%","y":"50%"},"findAll":false,"onlyCanChooseLocWhenInput":true}},{"name":"x","value":{"varType":"number","varScope":"script","showInput":true,"showInputLabel":"倍速：","mustInput":true,"rememberInputValue":true,"showInputContentAlign":"left","number":1,"selectItems":[0.25,0.5,0.75,1,1.25,1.5,1.75,2]}},{"name":"倍速修改","value":{"varType":"ui_text","varScope":"script","showInput":true,"mustInput":true,"showInputContentAlign":"left","textContent":"*其它倍速需进入编辑模式修改。该谱默认使用C大调，支持修改大调","textSize":10,"textColor":"#bcbcbc"}}],"dialogTitle":"设置琴键位点","dialogOKText":"继续","dialogCancelText":"none"}
{"type":"运行JS代码","delay":"0","delayUnit":1,"jsCode":"` + formattedStrings + `"}`
scriptDownloadButton.addEventListener('click', function () {
    const scriptContent = formatteScriptcode;  //zjs文件内容，暂时采用3.3内核
    const blob = new Blob([scriptContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = name + '_skyscript3.zjs';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
        
exportLink.addEventListener('click', exportTxt);
document.body.appendChild(exportLink);
</script>
</body>
</html>
